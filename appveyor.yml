version: 'test-{build}'
environment:
  matrix:
    - nodejs_version: '6'
    - nodejs_version: '8.11'
    - nodejs_version: '8.12'
      npm_version: 5.7.1
    - nodejs_version: '10.2'
    - nodejs_version: '10'
      npm_version: 5.7.1
    - nodejs_version: '8.12'
    - nodejs_version: '10'
    - nodejs_version: '12'
    - nodejs_version: ''
    - nodejs_version: '8'
platform:
  - x86
  - x64
clone_folder: 'c:\projects\%APPVEYOR_PROJECT_NAME%\node_modules\iobroker'
install:
  - ps: 'cd "c:\projects\$env:APPVEYOR_PROJECT_NAME"'
  - ps: Move-Item -Path node_modules\iobroker\test -Destination .
  - ps: .\test\appveyor_install.ps1
  - ps: |
      if ($env:iob_not_installed -eq "true") {
        echo "ioBroker was not installed (this was expected). Skipping next steps..."
        Exit-AppVeyorBuild
      }
test_script:
  - ps: 'cd "c:\projects\$env:APPVEYOR_PROJECT_NAME"'
  - npm install request mocha chai --no-optional --save & exit 0
  - ps: Start-Sleep -s 15
  - ps: tasklist
  - serviceIoBroker stop & exit 0
  - ps: Start-Sleep -s 15
  - serviceIoBroker start & exit 0
  - ps: Start-Sleep -s 60
  - ps: tasklist
  - dir .\
  - dir .\log\
  - type .\log\iobroker*.log & exit 0
  - node node_modules\mocha\bin\mocha --exit
build: 'off'
